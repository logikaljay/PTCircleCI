dependencies: 
  post: 
    - "wget https://saucelabs.com/downloads/sc-4.3-linux.tar.gz"
    - "tar -xzf sc-4.3-linux.tar.gz"
  pre: 
    - "mvn install -f pom.xml -Dmaven.test.skip=true -Dgpg.skip=true":
        pwd: test
machine: 
  environment: 
    M2: $HOME/.m2/apache-maven-3.1.1/bin/
    M2_HOME: $HOME/.m2/apache-maven-3.1.1/
    PATH: "$HOME/.m2/apache-maven-3.1.1/bin:$PATH"
    
  pre:
    - mkdir -p ~/.m2 
    - "curl -O http://apache.osuosl.org/maven/maven-3/3.1.1/binaries/apache-maven-3.1.1-bin.tar.gz && tar xvf apache-maven-3.1.1-bin.tar.gz -C ~/.m2"
    - mkdir -p $HOME/Downloads/
    - "curl https://nodejs.org/dist/v4.2.4/node-v4.2.4.pkg > $HOME/Downloads/node-4.2.4.pkg && sudo installer -store -pkg $HOME/Downloads/node-4.2.4.pkg -target /"
    
  xcode: 
    version: 7.2

test: 
  pre: 
    - "xcodebuild CODE_SIGNING_REQUIRED=NO CODE_SIGN_IDENTITY= PROVISIONING_PROFILE= -sdk iphonesimulator -destination \"platform=iOS Simulator,OS=9.2,name=iPhone 6\" -workspace=PTCircleCI.xcworkspace -scheme \"PTCircleCI\" CONFIGURATION_BUILD_DIR=\"~/dist/\" build":
        pwd: ios
    - "zip -r my_app.zip ~/PTCircleCI/ios/dist/PTCircleCI.app"
    - "curl -u $SAUCE_USERNAME:$SAUCE_ACCESS_KEY -X POST \"http://saucelabs.com/rest/v1/storage/$SAUCE_USERNAME/my_app.zip?overwrite=true\" -H \"Content-Type: \"application/octet-stream\" --data-binary @~/my_app.zip"

  override: 
    - ./bin/sc -u $SAUCE_USERNAME -k $SAUCE_ACCESS_KEY -f ~/sc_ready: 
        background: true
        pwd: sc-4.3-linux
    - "while [ ! -e ~/sc_ready ]; do sleep 1; done"
    - "mvn -Dtest=com.ptcircleci.appium.SauceTest test":
        pwd: test
