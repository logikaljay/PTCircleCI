machine:
  pre:
    - curl -O http://apache.osuosl.org/maven/maven-3/3.1.1/binaries/apache-maven-3.1.1-bin.tar.gz && tar xvf apache-maven-3.1.1-bin.tar.gz -C ~/.m2
  environment:
    PATH: $HOME/.m2/apache-maven-3.1.1/bin:$PATH
    M2_HOME: $HOME/.m2/apache-maven-3.1.1/
    M2: $HOME/.m2/apache-maven-3.1.1/bin/
  node:
    version: 4.2
  xcode:
    version: 7.2
    
dependencies:
  pre:
    - mvn install -f pom.xml -Dmaven.test.skip=true -Dgpg.skip=true
  post:
    - wget https://saucelabs.com/downloads/sc-4.3-linux.tar.gz
    - tar -xzf sc-4.3-linux.tar.gz

test:
  pre:
    - xcodebuild CODE_SIGNING_REQUIRED=NO CODE_SIGN_IDENTITY= PROVISIONING_PROFILE= -sdk iphonesimulator -destination "platform=iOS Simulator,OS=9.2,name=iPhone 6" -workspace=PTCircleCI.xcworkspace -scheme "PTCircleCI" CONFIGURATION_BUILD_DIR="~/dist/" build
    - zip -r my_app.zip ~/dist/PTCircleCI.app
    - curl -u $SAUCE_USER_NAME:$SAUCE_ACCESS_KEY -X POST "http://saucelabs.com/rest/v1/storage/$SAUCE_USER_NAME/my_app.zip?overwrite=true" -H "Content-Type: application/octet-stream" --data-binary @~/dist/my_app.zip
  override:
    - ./bin/sc -u $SAUCE_USERNAME -k $SAUCE_ACCESS_KEY -f ~/sc_ready:
        background: true
        pwd: sc-4.3-linux
    - while [ ! -e ~/sc_ready ]; do sleep 1; done
    - mvn -Dtest=com.ptcircleci.appium.SauceTest test
